# å¾…å¤„ç†ä»»åŠ¡

## å†…å­˜

10^6 * 200 * 10 * 9 bytes ~= 20 G

- æ£‹å­ä¿¡æ¯ä½¿ç”¨ np.int8
- å°†çŠ¶æ€ä¸ç‰¹å¾åˆ†ç¦»ï¼Œä»¥ä¿è¯`replay buffer`èƒ½å¤Ÿå­˜å‚¨100ä¸‡ç›˜å¯¹å±€ã€å‡è®¾é•¿åº¦ä¸º200ã€‘

## æ¸¸æˆ

- ç¯å¢ƒå§‹ç»ˆä»¥çº¢æ–¹è§’åº¦è¿”å›æ¸¸æˆç»“æœï¼Œå³å€¼åŒºé—´ä¸º`[-1,1]`ï¼Œå³`1`ä»£è¡¨å½“å‰çº¢èƒœï¼Œ`-1`ä»£è¡¨çº¢è´Ÿ
- æ¨¡å‹é¢„æµ‹ä¸æ­¤ä¸åŒï¼ŒçŠ¶æ€å€¼å‡½æ•°å€¼åŒºé—´ä¸º`[0,1]`ï¼Œå³`1`ä»£è¡¨å½“å‰èµ°å­æ–¹è·èƒœï¼Œ`-1`ä»£è¡¨å½“å‰èµ°å­æ–¹è´Ÿ
- MCTSæ¨¡æ‹Ÿæ—¶ï¼Œé»‘æ–¹èµ°å­åçš„å¥–åŠ±ï¼Œä½¿ç”¨è´Ÿå·è½¬æ¢ä¸ºé»‘æ–¹è§’åº¦çš„å¥–åŠ±ï¼ŒåŒæ ·ï¼Œå…¶å€¼ä¹Ÿéœ€è¦åå·

## çŸ¢é‡ç¯å¢ƒã€VectorEnvã€‘

1. `reset`
   è§‚å¯Ÿå‰¯æœ¬å¤åˆ¶Næ¬¡ã€‚`info`å­—å…¸åŒ…å«`to_play`åŠ`legal_actions`ä¿¡æ¯ã€‚

2. `step(actions)`
   æ­£å¸¸æƒ…å½¢ä¸‹ï¼Œè§‚å¯Ÿä¸º`next state`ï¼Œä½†å¦‚ç»ˆæ­¢æˆ–æˆªæ–­ï¼Œåˆ™è¿”å›åˆå§‹çŠ¶æ€ã€‚`next state`åœ¨`info`å­—å…¸`final_observation`ä¸­ä»¥åˆ—è¡¨å½¢å¼ï¼Œéç»ˆæ­¢æˆ–æˆªæ–­ä»¥`None`è¡¨è¾¾ã€‚

3. `close`

## ç‰¹å¾

+ é™¤è§‚å¯Ÿç‰¹å¾å¤–ï¼Œè‡³å°‘éœ€è¦å åŠ ä¸Šä¸€æ­¥ç§»åŠ¨ä¿¡æ¯ä½œä¸ºæ¨¡å‹è¾“å…¥ã€‚

## ä¿®æ”¹æ ‡è®°

ç›¸å¯¹äºåŸæ–‡ï¼Œä¿®æ”¹å¤„æ ‡è®°ï¼šğŸš¨

## ä¿®è®¢æ¸…å•

- [ ] æ£‹ç›˜è¿ç»­æœªåƒå­ã€æ­¥æ•°ã€åŠæ­¥æ•°æ£€éªŒé—®é¢˜
- [x] æ¸…é™¤èŠ‚ç‚¹`be_killed`å±æ€§
- [x] ä½¿ç”¨`graphviz`æ˜¾ç¤ºMCTSæ ¹èŠ‚ç‚¹æ ‘
- [x] åå‘ä¼ æ’­å€¼è®¡ç®—æ–¹å¼
- [x] è§£å†³`game`åœ¨`ray`åŒ…ä¸­åºåˆ—åŒ–é—®é¢˜
- [x] ç§»åŠ¨ç¼–ç  -> 0-2085 + 1ã€2086ä»£è¡¨ç©ºç™½ã€‘
- [x] ç¡®è®¤æ ·æœ¬å‡åŒ€æŠ½æ ·
- [x] éªŒè¯å¸æ”¶çŠ¶æ€ï¼šç»ˆæ­¢çŠ¶æ€é€’å½’æ¨ç†å‡ºç°é‡å¤ç»“æœ
- [x] ä»¥pngæ ¼å¼æ˜¾ç¤ºMCTSæ ‘æ—¶ï¼Œæ‰“å°ç¨‹åºæœªå®‰è£…å­—ä½“åº“å¯¼è‡´ä¸­æ–‡ä¹±ç 
- [x] åˆ†ç¦» ray
- [x] pygame:render ä¿®æ­£ç»Ÿè®¡ç»“æœ
- [x] pygame:render è®°è°±ä½¿ç”¨åˆ—è¡¨
- [x] pygameæ˜¾ç¤ºï¼šé»‘æ–¹å…ˆè¡Œæ—¶
  > |----  xxxx|

  > |xxxx xxxx|
- [ ] æ¨¡å‹ç‰ˆæœ¬å·ï¼šåªæœ‰æ ·æœ¬æ•°é‡è¾¾åˆ°æ‰¹é‡æ‰å¢åŠ 
- [ ] targetè®¡ç®—ï¼Œé‡ç‚¹åœ¨äºç¬¦å·
- [ ] rewardç›¸å¯¹äºæŒ‡å®šplayer?
- [ ] ä¿®æ­£MCTSæ ‘è¡¨è¾¾
- [ ] ä¿®æ­£model v1 åŠ¨æ€å‡½æ•°é—®é¢˜
- [ ] GPU:è®­ç»ƒæ—¶ä½¿ç”¨GPUï¼Œselfplayä½¿ç”¨cpu
- [ ] replay buffer -> mongodb
- [ ] å–æ¶ˆå‚æ•° use_max_priority
- [ ] é€’å½’æ¨ç†åº”è¯¥åŸºäº action list ?
- [ ] gameé™åˆ¶200æ­¥ ?
- [ ] æ£€æŸ¥100ä¸‡ç¼“å­˜å†…å­˜è€—ç”¨ï¼Œç›¸åº”è°ƒæ•´å­˜å‚¨å¯¹è±¡æ–¹å¼
- [ ] MCSTä¸­VALUEä¸REWARDï¼Œä»¥åŠåå‘ä¼ æ’­å¿…é¡»é™å®šå€¼åŒºé—´ -> [-1, 1]
- [ ] å¸æ”¶çŠ¶æ€ policy_logits è¡¨è¾¾ å‡åŒ€åˆ†å¸ƒ?å…¨éƒ¨ä¸º0? è®­ç»ƒ target è¡¨è¾¾æ–¹å¼
- [ ] recurrent_inference value -> v(s a)
- [ ] selfplay next state value back and truncated
- [ ] This is achieved by treating terminal states as absorbing states during training.
- [ ] å¾…å®š

## è¶…å‚æ•°

- num_unroll_steps look ahead steps 30,50,100,120
- td_steps paper è®ºæ–‡å»ºè®® 5 ==> [5,10,15,20]
- num_simulations è®ºæ–‡å»ºè®® 800 ==> [60,120,180,240,480,640]

## å¤‡æ³¨

- å•æ¸¸æˆè®­ç»ƒå†…å­˜1G

- å½“å­˜åœ¨2ç§å¯è¡Œè·¯å¾„æ—¶ï¼ŒMCTSæ¨¡æ‹Ÿ400æ¬¡åŸºæœ¬å¯ç¡®ä¿æ¦‚ç‡ç›¸ç­‰

- æ˜¾ç¤º`dot`å›¾

- Graphviz (dot) language support for Visual Studio Code

- `ctrl+shift+v` é¢„è§ˆ

```cmd
# GraphViz (dot) language support æœ¬åœ°å¯é¢„è§ˆ
dot -Tsvg input.dot -o output.svg
```

```python
import xqcpp

result = ""
# maps = ""
for i in range(2086):
    result += "{" + str(i) + ',"' + xqcpp.action2str(i+1) + '"},'
    # maps += '{"' + xqcpp.action2str(i+1) + '",' + str(i) + '},'
    if (i + 1) % 5 == 0:
        result += "\n"
        # maps += "\n"
print(result)
```
## å·¥å…·

### å†…å­˜ä½¿ç”¨
```bash
mprof run <path to file>
mprof plot
```

## å®éªŒ

| æ¡ˆä¾‹     | fen                                              | ç›®æ ‡              | é—®é¢˜                        | å¤‡æ³¨ |
| :------- | ------------------------------------------------ | :---------------- | :-------------------------- | :--- |
| å•æ­¥æ€   | 2bak4/5R3/9/3N5/9/5C3/9/9/4p1pr1/5K3 w - 110 0 1 | æ£€éªŒQ(s,a)        |                             |      |
| åœç€     |                                                  | æ£€éªŒç›®æ ‡è®¡ç®—      | 1. `6768`ä¸`4041`åº”è¯¥ç­‰æ¦‚ç‡ |      |
|          |                                                  | æ£€éªŒå¸æ”¶çŠ¶æ€      |                             |      |
| æœ€çŸ­è·¯å¾„ |                                                  | 1. å¤šç§æ€ï¼Œå–æœ€çŸ­ |                             |      |


## tasks

+ vec env
+ ray batch sezrch